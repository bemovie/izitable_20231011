<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="booking">

	<resultMap type="Booking" id="BookingMap">
		<id column="no" property="bookingNo"/>
		<result column="user_no" property="userNo"/>
		<result column="shop_no" property="shopNo"/>
		<result column="date" property="bookingDate"/>
		<result column="time" property="bookingTime"/>
		<result column="mem_num" property="bookingMemNum"/>
		
		<result column="email" property="userEmail"/>
		<result column="phone" property="userPhone"/>

		<result column="name" property="userName"/>
		
		<result column="day" property="bookingDate"/>
		<result column="hour" property="bookingTime"/>
	</resultMap>
	
	<resultMap type="ShopTime" id="shopTimeMap">
		<result column="shop_no" property="shopNo"/>
		<result column="day" property="bookingDate"/>
		<result column="hour" property="bookingTime"/>
	</resultMap>
	
	<select id="list" resultMap="BookingMap">
		SELECT * FROM tbl_booking
	</select>
	
	<select id="total" resultType="Integer">
		SELECT COUNT(*) FROM tbl_booking
	</select>
	
	<select id="totalShop" resultType="Integer">
		SELECT COUNT(*) FROM tbl_booking
		WHERE shop_no = #{shopNo}
	</select>
	
	<select id="totalUser" resultType="Integer">
		SELECT COUNT(*) FROM tbl_booking
		WHERE user_no = #{userNo}
	</select>
	
	<insert id="add">
		INSERT INTO tbl_booking (user_no, shop_no, date, time, mem_num)
		VALUES ( #{userNo}, #{shopNo}, #{bookingDate}, #{bookingTime}, #{bookingMemNum} )
	</insert>
	
	<select id="userBookingList" resultMap="BookingMap">
		SELECT tbl_booking.*, tbl_shop.* FROM tbl_booking JOIN tbl_shop ON tbl_booking.shop_no = tbl_shop.no
		WHERE tbl_booking.user_no = #{userNo}
	</select>
	
	<select id="userBookingDelete">
		DELETE FROM tbl_booking
		WHERE no = #{bookingNo}
	</select>
	
	<select id="shopBookingList" resultMap="BookingMap">
		SELECT tbl_booking.*, tbl_user.* 
		FROM tbl_booking JOIN tbl_user ON tbl_booking.user_no = tbl_user.no
		WHERE tbl_booking.shop_no = #{shopNo}
	</select>
	
	<select id="shopBookingUpdate">
		UPDATE tbl_booking
		SET date = #{bookingDate}, time = #{bookingTime}, mem_num = #{bookingMemNum}
		WHERE no = #{bookingNo}
	</select>
	
	<select id="shopBookingDelete">
		DELETE FROM tbl_booking
		WHERE no = #{bookingNo}
	</select>
	
	<select id="bookingTimeList" resultMap="shopTimeMap">
		SELECT hour FROM tbl_shop_time
		WHERE shop_no = #{shopNo} and day = DAYOFWEEK(#{bookingDate})
	</select>
	
</mapper>